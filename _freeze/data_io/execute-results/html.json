{
  "hash": "72214e56a620d12dd24893c4289b6cc4",
  "result": {
    "engine": "knitr",
    "markdown": "# データの読み込みと書き出し\n\nここまでの章で、RとIDEの準備、簡単なRの操作方法を学びました。いよいよ実際のデータを扱う方法のパートに入っていきます。\n\nデータ分析の第一歩は、データをRに読み込むことです。この章では、CSVファイルやExcelファイルからデータを読み込み、加工したデータを保存する方法について説明します。\n\n## 学習内容\n\nこの章を読み終えると、以下ができるようになります。\n\n- CSVファイルからデータを読み込む\n- データの内容を確認する\n- データをCSVファイルとして保存する\n- Excelファイルからデータを読み込む\n- 日本語の文字化け問題に対処する（エンコードの指定）\n\n## 使用するパッケージ\n\nこの章では以下のパッケージを使用します。`c()`関数を使ってまとめてインストールできます。\n\n```r\n# パッケージのインストール（初回のみ）\ninstall.packages(c(\"readr\", \"readxl\", \"here\"))\n```\n\n## CSVファイルの読み込み\n\nCSVファイル（Comma-Separated Values）は、最も一般的なデータ形式の一つです。ExcelやGoogle スプレッドシートでも簡単に作成・保存できます。\n\n### readrパッケージを使う\n\nRには`read.csv()`という標準関数もありますが、より高速で使いやすい`readr`パッケージの`read_csv()`を使うことをおすすめします。`readr`パッケージは`tidyverse`にも含まれているので、`tidyverse`をインストールしている場合は追加でインストールする必要はありません。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readr)\n\n# CSVファイルを読み込む\ndata <- read_csv(\"data/sample_data.csv\")\n```\n:::\n\n\n::: {.callout-note}\n## ファイルパスの指定方法\n\nファイルパスは、プロジェクトのルートディレクトリ（.Rprojファイルがある場所、あるいはPositronで開いているフォルダ）からの相対パスで指定します。\n\n例えば、プロジェクト内に`data`フォルダを作り、その中に`sample_data.csv`を置いた場合は、`\"data/sample_data.csv\"`と指定します。\n\n```\n# 上記の例\nmy_project/\n├── data/\n│   └── sample_data.csv\n└── analysis.Rproj\n```\n:::\n\n### hereパッケージでパスを管理する\n\nプロジェクト管理の章で学んだように、`here`パッケージを使うとさらに確実です。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(here)\nlibrary(readr)\n\n# hereを使ってパスを指定\ndata <- read_csv(here(\"data\", \"sample_data.csv\"))\n```\n:::\n\n\n`here()`関数は、プロジェクトのルートディレクトリからの相対パスを自動で構築してくれます。WindowsとMac/Linuxでパスの書き方が異なる問題も解決できます。\n\n上記の例ではルートディレクトリにある`data`フォルダの中の`sample_data.csv`を読み込む、ということをしています。`here(\"data/sample_data.csv\")`としても問題ありません。\n\n## データの確認\n\nデータを読み込んだら、まず内容を確認しましょう。\n\n### head() - 最初の数行を表示\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 最初の6行を表示（デフォルト）\nhead(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 4\n  名前      年齢 部署   売上\n  <chr>    <dbl> <chr> <dbl>\n1 田中太郎    25 営業   1200\n2 佐藤花子    30 開発   1500\n3 鈴木一郎    35 営業    980\n4 高橋次郎    28 開発   1350\n5 伊藤三郎    42 総務   1100\n```\n\n\n:::\n:::\n\n\n### glimpse() - データ構造を一覧\n\n`dplyr`パッケージの`glimpse()`関数は、データの構造をコンパクトに表示してくれます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n\n# データ構造を確認\nglimpse(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 5\nColumns: 4\n$ 名前 <chr> \"田中太郎\", \"佐藤花子\", \"鈴木一郎\", \"高橋次郎\", \"伊藤三郎\"\n$ 年齢 <dbl> 25, 30, 35, 28, 42\n$ 部署 <chr> \"営業\", \"開発\", \"営業\", \"開発\", \"総務\"\n$ 売上 <dbl> 1200, 1500, 980, 1350, 1100\n```\n\n\n:::\n:::\n\n\n`glimpse()`を実行すると、以下のような情報が表示されます。\n\n- 行数と列数\n- 各列の名前と型（文字列、数値など）\n- 各列の最初の数個のデータ\n\n### View() - データをスプレッドシート形式で表示\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# データビューアーで開く\nView(data)\n```\n:::\n\n\n::: {.callout-tip}\n## IDE上でのデータ確認\n\nRStudioでは、Environmentペインにあるデータ名をクリックすることでも`View()`と同じ結果が得られます。スプレッドシート形式でデータを確認できるので、非常に便利です。  \nPositronの場合は、画面右側にVARIABLESペインがあり、そこにデータが表示されるので、見たいデータをダブルクリックすれば同様に確認できます。Positronの場合は平均値や欠損数も表示されるので便利だと思います。\n\n![Positronのデータビューア](figures/data_io/data_viewer.png)\n:::\n\n## 実践例：サンプルデータを読み込む\n\n実際にサンプルデータを作成して読み込んでみましょう。\n\n### サンプルCSVファイルの作成\n\nまず、プロジェクト内に`data`フォルダを作成します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# dataフォルダを作成（存在しない場合）\nif (!dir.exists(\"data\")) {\n  dir.create(\"data\")\n}\n```\n:::\n\n\n次に、簡単なサンプルデータを作成して保存します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readr)\n\n# サンプルデータの作成\nsample_data <- data.frame(\n  名前 = c(\"田中太郎\", \"佐藤花子\", \"鈴木一郎\", \"高橋次郎\", \"伊藤三郎\"),\n  年齢 = c(25, 30, 35, 28, 42),\n  部署 = c(\"営業\", \"開発\", \"営業\", \"開発\", \"総務\"),\n  売上 = c(1200, 1500, 980, 1350, 1100)\n)\n\n# CSVファイルとして保存\nwrite_csv(sample_data, \"data/sales_data.csv\")\n```\n:::\n\n\n### データの読み込みと確認\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# データを読み込む\nsales_data <- read_csv(\"data/sales_data.csv\")\n\n# データの確認\nprint(sales_data)\n\n# 構造を確認\nglimpse(sales_data)\n```\n:::\n\n\n## データの書き出し\n\nデータを加工した後は、結果を保存する必要があります。\n\n### CSVファイルとして保存\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readr)\n\n# データをCSVファイルとして保存\nwrite_csv(sales_data, \"data/processed_sales.csv\")\n```\n:::\n\n\n::: {.callout-tip}\n## データ保存のベストプラクティス\n\nプロジェクト内でデータを整理する際は、以下のようなフォルダ構成がおすすめです。\n\n```\nmy_project/\n├── data/\n│   ├── raw/          # 元データ（読み取り専用、編集しない）\n│   └── processed/    # 加工済みデータ\n├── scripts/\n└── outputs/\n```\n\n元データは`raw`フォルダに保存し、加工したデータは`processed`フォルダに保存することで、データの管理が容易になります。\n:::\n\n## 日本語データの扱い\n\n日本語を含むCSVファイルを扱う際、文字化けが発生することがあります。\n\n### 文字コードの問題\n\nWindowsで作成されたCSVファイルは、多くの場合Shift-JISという文字コードで保存されています。一方、R（とreadr）はデフォルトでUTF-8を想定しています。\n\n### 文字化けの対処法\n\nShift-JISのファイルを読み込む場合は、エンコーディングを指定します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Shift-JISのCSVファイルを読み込む\ndata <- read_csv(\n  \"data/japanese_data.csv\",\n  locale = locale(encoding = \"Shift-JIS\")\n)\n```\n:::\n\n\n::: {.callout-caution}\n## 文字コードの確認方法\n\nファイルの文字コードがわからない場合は、以下を試してください。\n\n1. まず何も指定せずに読み込んでみる\n2. 文字化けしたら、`locale = locale(encoding = \"Shift-JIS\")`を追加\n3. それでもダメなら、`locale = locale(encoding = \"CP932\")`を試す\n\nちなみにCP932はShift-JISのMicrosoft拡張版で、Windowsで作成されたファイルはCP932で保存されていることが多いです。  \n現代では、可能な限りUTF-8でデータを保存することが推奨されます^[とはいえ、国のオープンデータなどではまだまだShift-JISのデータも多いので要注意です。]。\n:::\n\n## Excelファイルの読み込み\n\nExcelファイル（.xlsxや.xls）からデータを読み込むには、`readxl`パッケージを使います。\n\n### readxlパッケージ\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readxl)\n\n# Excelファイルを読み込む\nexcel_data <- read_excel(\"data/sample_data.xlsx\")\n```\n:::\n\n\n### シートの指定\n\nExcelファイルに複数のシートがある場合、読み込むシートを指定できます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# シート名で指定\nexcel_data <- read_excel(\"data/sample_data.xlsx\", sheet = \"売上データ\")\n\n# シート番号で指定（1から始まる）\nexcel_data <- read_excel(\"data/sample_data.xlsx\", sheet = 2)\n```\n:::\n\n\n### 範囲の指定\n\n特定のセル範囲のみを読み込むこともできます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# A1からD10の範囲を読み込む\nexcel_data <- read_excel(\"data/sample_data.xlsx\", range = \"A1:D10\")\n```\n:::\n\n\n::: {.callout-note}\n## ExcelファイルとCSVファイルの使い分け\n\n- **Excelファイル**: 複数シート、書式設定、数式などが必要な場合\n- **CSVファイル**: シンプルなデータの保存・共有、他のツールとの互換性が必要な場合\n\nデータ分析では、Excelで作成したデータをCSV形式でエクスポートして使うことも多いです。\n:::\n\n## 練習問題\n\nここまで学んだ内容を確認しましょう。\n\n::: {.callout-tip collapse=\"true\"}\n## 問題1: サンプルデータの作成と保存\n\n以下の条件でデータを作成し、CSVファイルとして保存してください。\n\n- 列: 商品名、価格、在庫数\n- 行: 5つの商品\n\n**解答例**\n```r\nlibrary(readr)\n\n# サンプルデータの作成\nproducts <- data.frame(\n  商品名 = c(\"りんご\", \"バナナ\", \"オレンジ\", \"ぶどう\", \"いちご\"),\n  価格 = c(150, 100, 200, 300, 250),\n  在庫数 = c(50, 80, 30, 20, 40)\n)\n\n# 保存\nwrite_csv(products, \"data/products.csv\")\n```\n:::\n\n::: {.callout-tip collapse=\"true\"}\n## 問題2: データの読み込みと確認\n\n問題1で作成したCSVファイルを読み込み、以下を確認してください。\n\n1. データの最初の3行\n2. データの構造\n\n**解答例**\n```r\nlibrary(readr)\nlibrary(dplyr)\n\n# データの読み込み\nproducts <- read_csv(\"data/products.csv\")\n\n# 最初の3行\nhead(products, n = 3)\n\n# 構造の確認\nglimpse(products)\n```\n:::\n\n::: {.callout-tip collapse=\"true\"}\n## 問題3: hereパッケージを使う\n\n問題2の読み込みを、`here`パッケージを使って書き直してください。\n\n**解答例**\n```r\nlibrary(readr)\nlibrary(here)\n\n# hereを使ってデータを読み込む\nproducts <- read_csv(here(\"data\", \"products.csv\"))\n```\n:::\n\n## まとめ\n\nこの章では、以下を学びました。\n\n- ✅ `readr`パッケージを使ったCSVファイルの読み込み\n- ✅ `head()`, `glimpse()`, `View()`によるデータ確認\n- ✅ `write_csv()`によるデータの保存\n- ✅ 日本語データの文字化け対策\n- ✅ `readxl`パッケージを使ったExcelファイルの読み込み\n- ✅ `here`パッケージによる確実なパス管理\n\nこれで、外部ファイルからデータを読み込み、確認し、保存することができるようになりました。次の章では、読み込んだデータを加工する方法を学びます。\n\n::: {.callout-note}\n## 次のステップ\n\n次の章「データハンドリング基礎 - dplyr入門」では、読み込んだデータを自在に操作する方法を学びます。データの絞り込み、並び替え、列の選択など、実務で頻繁に使う操作を習得しましょう。\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}